@model Platform_Learning_Test.Domain.Dto.TestResultDetailsDto

@{
    ViewData["Title"] = "Детали результата теста";
}

<div class="container mt-4">
    <h2>@ViewData["Title"]</h2>

    <div class="card mb-4">
        <div class="card-header">
            <h4>@Model.TestTitle</h4>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-6">
                    <p><strong>Дата завершения:</strong> @Model.CompletedAt.ToString("g")</p>
                    <p><strong>Правильных ответов:</strong> @Model.CorrectAnswers из @Model.TotalQuestions</p>
                </div>
                <div class="col-md-6">
                    <div class="text-center">
                        <div class="result-circle mx-auto mb-3">
                            <h2 class="result-percent">@Model.ScorePercentage.ToString("0")%</h2>
                        </div>
                        <h4>@GetResultMessage(Model.ScorePercentage)</h4>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <h4>Детали по вопросам</h4>
    @foreach (var result in Model.QuestionResults)
    {
        <div class="card mb-3 @(result.IsCorrect ? "border-success" : "border-danger")">
            <div class="card-body">
                <div class="d-flex justify-content-between">
                    <h5>@result.QuestionText</h5>
                    <span class="badge bg-@(result.IsCorrect ? "success" : "danger")">
                        @(result.IsCorrect ? "Правильно" : "Неправильно")
                    </span>
                </div>
                <p class="mt-2"><strong>Ваш ответ:</strong> @result.SelectedAnswer</p>
                @if (!result.IsCorrect)
                {
                    <p><strong>Правильный ответ:</strong> @result.CorrectAnswer</p>
                }
            </div>
        </div>
    }


    <a asp-action="Index" class="btn btn-secondary">Назад к списку</a>
</div>

@functions {
    string GetResultMessage(double percentage)
    {
        return percentage switch
        {
            >= 80 => "Отличный результат!",
            >= 60 => "Хороший результат!",
            >= 40 => "Можно лучше!",
            _ => "Попробуйте еще раз!"
        };
    }
}

<style>
    .result-circle {
        width: 150px;
        height: 150px;
        border-radius: 50%;
        background: conic-gradient( #28a745 @(Model.ScorePercentage * 3.6) deg, #e9ecef @(Model.ScorePercentage * 3.6) deg 360deg );
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .result-percent {
        color: #495057;
        font-weight: bold;
        margin: 0;
    }
</style>